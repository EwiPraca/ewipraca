@model EwiPraca.Models.CompanyEmployeesViewModel
@{
    ViewBag.Title = "Kalendarz";
}

@section navigation{
    @Html.Partial("_Menu", new MenuViewModel() { MyProfileSelected = true })
}

@section scripts{
    <link href="~/Content/fullcalendar.print.min.css" rel="stylesheet" media="print" />
    <link href="~/Content/fullcalendar.min.css" rel="stylesheet" />
    <link href="~/Scripts/qTip/jquery.qtip.min.css" rel="stylesheet" />
    <script src="~/Scripts/moment.min.js"></script>
    <script src="~/Scripts/moment-with-locales.min.js"></script>
    <script src="~/Scripts/fullcalendar.min.js"></script>
    <script src="~/Scripts/fullcalendar.helper.min.js"></script>
    <script src='~/Scripts/locale-all.js'></script>
    <script src="~/Scripts/qTip/jquery.qtip.min.js"></script>
}
<header class="page-header">
    <h1 class="page-title align-center">@ViewBag.Title</h1>
</header>
<div id="calendar"></div>

<div class="row last-row">
    <p class="align-center">
        <a href="@Url.Action("DisplayCompany", "Company", new { id = Model.CompanyId })" class="button"><span class="glyphicon"></span>Powrót</a>
    </p>
</div>

<script>
    $(document).ready(function () {
        $('#calendar').fullCalendar({
            locale: 'pl',
            header:
            {
                left: 'prev,next today',
                center: 'title',
                right: 'month,agendaWeek,agendaDay'
            },
            buttonText: {
                today: 'Dzisiaj',
                month: 'Miesiąc',
                week: 'Tydzień',
                day: 'Dzień'
            },
            eventTextColor: "#ffffff",

            events: function (start, end, timezone, callback) {
                $.ajax({
                    url: '@Url.Action("GetCalendarData", "Calendar", new { companyId = Model.CompanyId })',
                    type: "GET",
                    dataType: "JSON",

                    success: function (result) {
                        var events = [];

                        $.each(result, function (i, data) {
                            events.push(
                           {
                               title: data.Title,
                               description: data.Desc,
                               start: moment(data.StartDate).format('YYYY-MM-DD'),
                               end: moment(data.EndDate).format('YYYY-MM-DD'),
                               backgroundColor: "#f15a23",
                               borderColor: "#f15a23",
                           });
                        });

                        callback(events);
                    }
                });
            },

            eventRender: function (event, element) {
                element.qtip(
                {
                    content: event.description
                });
            },

            editable: false
        });
    });
</script>
